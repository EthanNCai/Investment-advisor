2025-05-17 12:08:33,097 - __main__ - INFO - 初始化训练器，会话ID: 20250517_120833
2025-05-17 12:08:33,098 - __main__ - INFO - 开始训练流程: XAU/XAG, 模型类型: hybrid
2025-05-17 12:08:33,113 - __main__ - INFO - 获取股票 XAU 数据: 2668 条记录
2025-05-17 12:08:33,124 - __main__ - INFO - 获取股票 XAG 数据: 2664 条记录
2025-05-17 12:08:33,145 - __main__ - INFO - 准备价格比值数据: XAU/XAG, 原始记录数: A=2668, B=2664, 对齐后记录数: 2664
2025-05-17 12:08:33,388 - __main__ - WARNING - 移除4个近似常数特征: ['A_amount', 'A_turnover', 'B_amount', 'B_turnover']
2025-05-17 12:08:33,391 - __main__ - WARNING - F回归特征选择失败: Input contains NaN, infinity or a value too large for dtype('float64').
2025-05-17 12:08:33,392 - __main__ - WARNING - 互信息特征选择失败: Input contains NaN, infinity or a value too large for dtype('float64').
2025-05-17 12:08:33,394 - __main__ - WARNING - 随机森林特征选择失败: Input contains NaN, infinity or a value too large for dtype('float32').
2025-05-17 12:08:33,395 - __main__ - WARNING - Lasso特征选择失败: Input contains NaN, infinity or a value too large for dtype('float64').
2025-05-17 12:08:33,395 - __main__ - INFO - 前20个最重要特征:
2025-05-17 12:08:33,397 - __main__ - INFO - A_open: 1.0000
2025-05-17 12:08:33,397 - __main__ - INFO - B_ma20: 1.0000
2025-05-17 12:08:33,397 - __main__ - INFO - ratio_rsi: 1.0000
2025-05-17 12:08:33,397 - __main__ - INFO - ratio_to_ma30: 1.0000
2025-05-17 12:08:33,398 - __main__ - INFO - ma30_ratio: 1.0000
2025-05-17 12:08:33,398 - __main__ - INFO - ratio_to_ma20: 1.0000
2025-05-17 12:08:33,398 - __main__ - INFO - ma20_ratio: 1.0000
2025-05-17 12:08:33,398 - __main__ - INFO - ratio_to_ma10: 1.0000
2025-05-17 12:08:33,398 - __main__ - INFO - ma10_ratio: 1.0000
2025-05-17 12:08:33,398 - __main__ - INFO - ratio_to_ma5: 1.0000
2025-05-17 12:08:33,398 - __main__ - INFO - ma5_ratio: 1.0000
2025-05-17 12:08:33,398 - __main__ - INFO - B_close_to_low: 1.0000
2025-05-17 12:08:33,398 - __main__ - INFO - B_close_to_high: 1.0000
2025-05-17 12:08:33,398 - __main__ - INFO - B_bb_width: 1.0000
2025-05-17 12:08:33,398 - __main__ - INFO - B_bb_lower: 1.0000
2025-05-17 12:08:33,398 - __main__ - INFO - B_bb_upper: 1.0000
2025-05-17 12:08:33,398 - __main__ - INFO - B_bb_std: 1.0000
2025-05-17 12:08:33,398 - __main__ - INFO - B_bb_middle: 1.0000
2025-05-17 12:08:33,398 - __main__ - INFO - B_volume_ratio: 1.0000
2025-05-17 12:08:33,398 - __main__ - INFO - B_volume_ma10: 1.0000
2025-05-17 12:08:33,398 - __main__ - INFO - 特征选择: 从 113 个特征中选择了 38 个特征
2025-05-17 12:08:33,398 - __main__ - INFO - 特征工程完成，从 2664 条记录创建了 1378 条有效特征记录，特征数量: 38
2025-05-17 12:08:33,404 - __main__ - INFO - 数据分割完成 - 训练集: 940, 验证集: 202, 测试集: 202
2025-05-17 12:08:33,407 - __main__ - ERROR - 训练流程出错: Input contains infinity or a value too large for dtype('float64').
2025-05-17 12:08:33,410 - __main__ - ERROR - Traceback (most recent call last):
  File "D:\software\Investment-advisor\back_end\peudo_backend\prediction\model_trainer.py", line 1563, in run_complete_training_pipeline
    X_train, X_val, X_test, y_train, y_val, y_test
  File "D:\software\Investment-advisor\back_end\peudo_backend\prediction\model_trainer.py", line 682, in scale_data
    X_train_scaled = feature_scaler.fit_transform(X_train_reshaped)
  File "D:\software\Python\explain\lib\site-packages\sklearn\base.py", line 852, in fit_transform
    return self.fit(X, **fit_params).transform(X)
  File "D:\software\Python\explain\lib\site-packages\sklearn\preprocessing\_data.py", line 1493, in fit
    force_all_finite="allow-nan",
  File "D:\software\Python\explain\lib\site-packages\sklearn\base.py", line 566, in _validate_data
    X = check_array(X, **check_params)
  File "D:\software\Python\explain\lib\site-packages\sklearn\utils\validation.py", line 800, in check_array
    _assert_all_finite(array, allow_nan=force_all_finite == "allow-nan")
  File "D:\software\Python\explain\lib\site-packages\sklearn\utils\validation.py", line 116, in _assert_all_finite
    type_err, msg_dtype if msg_dtype is not None else X.dtype
ValueError: Input contains infinity or a value too large for dtype('float64').

2025-05-17 12:17:36,297 - __main__ - INFO - 初始化训练器，会话ID: 20250517_121736
2025-05-17 12:17:36,297 - __main__ - INFO - 开始训练流程: XAU/XAG, 模型类型: hybrid
2025-05-17 12:17:36,305 - __main__ - INFO - 获取股票 XAU 数据: 2668 条记录
2025-05-17 12:17:36,311 - __main__ - INFO - 获取股票 XAG 数据: 2664 条记录
2025-05-17 12:17:36,318 - __main__ - INFO - 准备价格比值数据: XAU/XAG, 原始记录数: A=2668, B=2664, 对齐后记录数: 2664
2025-05-17 12:17:36,493 - __main__ - WARNING - 移除4个近似常数特征: ['A_amount', 'A_turnover', 'B_amount', 'B_turnover']
2025-05-17 12:17:36,495 - __main__ - WARNING - F回归特征选择失败: Input contains NaN, infinity or a value too large for dtype('float64').
2025-05-17 12:17:36,496 - __main__ - WARNING - 互信息特征选择失败: Input contains NaN, infinity or a value too large for dtype('float64').
2025-05-17 12:17:36,497 - __main__ - WARNING - 随机森林特征选择失败: Input contains NaN, infinity or a value too large for dtype('float32').
2025-05-17 12:17:36,498 - __main__ - WARNING - Lasso特征选择失败: Input contains NaN, infinity or a value too large for dtype('float64').
2025-05-17 12:17:36,499 - __main__ - INFO - 前20个最重要特征:
2025-05-17 12:17:36,499 - __main__ - INFO - A_open: 1.0000
2025-05-17 12:17:36,499 - __main__ - INFO - B_ma20: 1.0000
2025-05-17 12:17:36,500 - __main__ - INFO - ratio_rsi: 1.0000
2025-05-17 12:17:36,500 - __main__ - INFO - ratio_to_ma30: 1.0000
2025-05-17 12:17:36,500 - __main__ - INFO - ma30_ratio: 1.0000
2025-05-17 12:17:36,500 - __main__ - INFO - ratio_to_ma20: 1.0000
2025-05-17 12:17:36,500 - __main__ - INFO - ma20_ratio: 1.0000
2025-05-17 12:17:36,500 - __main__ - INFO - ratio_to_ma10: 1.0000
2025-05-17 12:17:36,500 - __main__ - INFO - ma10_ratio: 1.0000
2025-05-17 12:17:36,500 - __main__ - INFO - ratio_to_ma5: 1.0000
2025-05-17 12:17:36,500 - __main__ - INFO - ma5_ratio: 1.0000
2025-05-17 12:17:36,500 - __main__ - INFO - B_close_to_low: 1.0000
2025-05-17 12:17:36,500 - __main__ - INFO - B_close_to_high: 1.0000
2025-05-17 12:17:36,500 - __main__ - INFO - B_bb_width: 1.0000
2025-05-17 12:17:36,500 - __main__ - INFO - B_bb_lower: 1.0000
2025-05-17 12:17:36,500 - __main__ - INFO - B_bb_upper: 1.0000
2025-05-17 12:17:36,500 - __main__ - INFO - B_bb_std: 1.0000
2025-05-17 12:17:36,500 - __main__ - INFO - B_bb_middle: 1.0000
2025-05-17 12:17:36,500 - __main__ - INFO - B_volume_ratio: 1.0000
2025-05-17 12:17:36,500 - __main__ - INFO - B_volume_ma10: 1.0000
2025-05-17 12:17:36,500 - __main__ - INFO - 特征选择: 从 113 个特征中选择了 38 个特征
2025-05-17 12:17:36,501 - __main__ - INFO - 特征工程完成，从 2664 条记录创建了 1378 条有效特征记录，特征数量: 38
2025-05-17 12:17:36,507 - __main__ - INFO - 数据分割完成 - 训练集: 940, 验证集: 202, 测试集: 202
2025-05-17 12:17:36,510 - __main__ - ERROR - 训练流程出错: Input contains infinity or a value too large for dtype('float64').
2025-05-17 12:17:36,512 - __main__ - ERROR - Traceback (most recent call last):
  File "D:\software\Investment-advisor\back_end\peudo_backend\prediction\model_trainer.py", line 1563, in run_complete_training_pipeline
    X_train, X_val, X_test, y_train, y_val, y_test
  File "D:\software\Investment-advisor\back_end\peudo_backend\prediction\model_trainer.py", line 682, in scale_data
    X_train_scaled = feature_scaler.fit_transform(X_train_reshaped)
  File "D:\software\Python\explain\lib\site-packages\sklearn\base.py", line 852, in fit_transform
    return self.fit(X, **fit_params).transform(X)
  File "D:\software\Python\explain\lib\site-packages\sklearn\preprocessing\_data.py", line 1493, in fit
    force_all_finite="allow-nan",
  File "D:\software\Python\explain\lib\site-packages\sklearn\base.py", line 566, in _validate_data
    X = check_array(X, **check_params)
  File "D:\software\Python\explain\lib\site-packages\sklearn\utils\validation.py", line 800, in check_array
    _assert_all_finite(array, allow_nan=force_all_finite == "allow-nan")
  File "D:\software\Python\explain\lib\site-packages\sklearn\utils\validation.py", line 116, in _assert_all_finite
    type_err, msg_dtype if msg_dtype is not None else X.dtype
ValueError: Input contains infinity or a value too large for dtype('float64').

2025-05-17 12:23:34,849 - __main__ - INFO - 初始化训练器，会话ID: 20250517_122334
2025-05-17 12:23:34,850 - __main__ - INFO - 开始训练流程: XAU/XAG, 模型类型: hybrid
2025-05-17 12:23:34,859 - __main__ - INFO - 获取股票 XAU 数据: 2668 条记录
2025-05-17 12:23:34,866 - __main__ - INFO - 获取股票 XAG 数据: 2664 条记录
2025-05-17 12:23:34,874 - __main__ - INFO - 准备价格比值数据: XAU/XAG, 原始记录数: A=2668, B=2664, 对齐后记录数: 2664
2025-05-17 12:23:34,998 - __main__ - WARNING - 以下4列为常量值，考虑删除：['A_amount', 'A_turnover', 'B_amount', 'B_turnover']
2025-05-17 12:23:34,999 - __main__ - INFO - 特征工程完成，从 2664 条记录创建了 2664 条有效特征记录，特征数量: 113
2025-05-17 12:23:35,025 - __main__ - INFO - 数据分割完成 - 训练集: 1840, 验证集: 395, 测试集: 395
2025-05-17 12:23:35,025 - __main__ - INFO - 开始数据缩放前的安全检查，检测无穷值和极端值...
2025-05-17 12:23:35,460 - __main__ - INFO - 数据缩放完成，使用缩放器: robust
2025-05-17 12:23:35,954 - __main__ - INFO - 构建了hybrid类型的LSTM模型，损失函数: huber
2025-05-17 12:23:35,955 - __main__ - INFO - 模型输入形状: (30, 113)
2025-05-17 12:23:35,955 - __main__ - INFO - 开始训练模型，最大轮数: 150, 批大小: 32
2025-05-17 12:25:46,576 - __main__ - INFO - 训练完成，耗时: 130.62秒
2025-05-17 12:25:46,999 - __main__ - INFO - 方向准确率: 51.77%, MAPE: 4.57%, 最大误差: 20.163590
2025-05-17 12:25:46,999 - __main__ - INFO - 方向预测准确率: 51.77%
2025-05-17 12:25:46,999 - __main__ - WARNING - 模型性能较差，考虑调整参数或使用不同的模型架构
2025-05-17 12:25:47,421 - __main__ - INFO - 预测可视化图表已保存至: training_logs\results_20250517_122334\predictions.png
2025-05-17 12:25:47,436 - __main__ - WARNING - 训练历史中不包含MAE指标，跳过MAE曲线绘制
2025-05-17 12:25:47,440 - __main__ - WARNING - 训练历史中不包含MSE指标，跳过MSE曲线绘制
2025-05-17 12:25:48,448 - __main__ - INFO - 训练历史图表已保存至: training_logs\results_20250517_122334\training_history.png
2025-05-17 12:25:48,469 - __main__ - INFO - 模型已保存至: trained_models\XAU_XAG_hybrid_seq30_model\model.h5
2025-05-17 12:25:48,470 - __main__ - INFO - 缩放器已保存至: trained_models\XAU_XAG_hybrid_seq30_model\scalers.pkl
2025-05-17 12:25:48,473 - __main__ - INFO - 训练历史已保存至: trained_models\XAU_XAG_hybrid_seq30_model\training_history.json
2025-05-17 12:25:48,477 - __main__ - INFO - 模型元数据已保存至: trained_models\XAU_XAG_hybrid_seq30_model\metadata.json
2025-05-17 12:25:48,477 - __main__ - INFO - 训练流程完成，总耗时: 133.63秒
2025-05-17 12:27:31,678 - __main__ - INFO - 初始化训练器，会话ID: 20250517_122731
2025-05-17 12:27:31,678 - __main__ - INFO - 开始训练流程: XAU/XAG, 模型类型: hybrid
2025-05-17 12:27:31,686 - __main__ - INFO - 获取股票 XAU 数据: 2668 条记录
2025-05-17 12:27:31,693 - __main__ - INFO - 获取股票 XAG 数据: 2664 条记录
2025-05-17 12:27:31,699 - __main__ - INFO - 准备价格比值数据: XAU/XAG, 原始记录数: A=2668, B=2664, 对齐后记录数: 2664
2025-05-17 12:27:31,815 - __main__ - WARNING - 以下4列为常量值，考虑删除：['A_amount', 'A_turnover', 'B_amount', 'B_turnover']
2025-05-17 12:27:31,816 - __main__ - INFO - 特征工程完成，从 2664 条记录创建了 2664 条有效特征记录，特征数量: 113
2025-05-17 12:27:31,831 - __main__ - INFO - 数据分割完成 - 训练集: 1840, 验证集: 395, 测试集: 395
2025-05-17 12:27:31,832 - __main__ - INFO - 开始数据缩放前的安全检查，检测无穷值和极端值...
2025-05-17 12:27:32,265 - __main__ - INFO - 数据缩放完成，使用缩放器: robust
2025-05-17 12:27:32,650 - __main__ - INFO - 构建了hybrid类型的LSTM模型，损失函数: huber
2025-05-17 12:27:32,650 - __main__ - INFO - 模型输入形状: (30, 113)
2025-05-17 12:27:32,650 - __main__ - INFO - 开始训练模型，最大轮数: 150, 批大小: 32
2025-05-17 12:29:57,653 - __main__ - INFO - 训练完成，耗时: 145.00秒
2025-05-17 12:29:58,065 - __main__ - INFO - 方向准确率: 50.81%, MAPE: 5.49%, 最大误差: 21.181854
2025-05-17 12:29:58,065 - __main__ - INFO - 方向预测准确率: 50.81%
2025-05-17 12:29:58,065 - __main__ - WARNING - 模型性能较差，考虑调整参数或使用不同的模型架构
2025-05-17 12:29:58,065 - __main__ - WARNING - R2值为负，表明模型预测比简单使用均值预测还要差
2025-05-17 12:29:58,472 - __main__ - INFO - 预测可视化图表已保存至: training_logs\results_20250517_122731\predictions.png
2025-05-17 12:29:58,486 - __main__ - WARNING - 训练历史中不包含MAE指标，跳过MAE曲线绘制
2025-05-17 12:29:58,491 - __main__ - WARNING - 训练历史中不包含MSE指标，跳过MSE曲线绘制
2025-05-17 12:29:59,546 - __main__ - INFO - 训练历史图表已保存至: training_logs\results_20250517_122731\training_history.png
2025-05-17 12:29:59,570 - __main__ - INFO - 模型已保存至: trained_models\XAU_XAG_hybrid_seq30_model\model.h5
2025-05-17 12:29:59,571 - __main__ - INFO - 缩放器已保存至: trained_models\XAU_XAG_hybrid_seq30_model\scalers.pkl
2025-05-17 12:29:59,572 - __main__ - INFO - 训练历史已保存至: trained_models\XAU_XAG_hybrid_seq30_model\training_history.json
2025-05-17 12:29:59,577 - __main__ - INFO - 模型元数据已保存至: trained_models\XAU_XAG_hybrid_seq30_model\metadata.json
2025-05-17 12:29:59,577 - __main__ - INFO - 训练流程完成，总耗时: 147.90秒
